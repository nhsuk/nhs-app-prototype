{% set PROTOTYPEURL = "your-health/gp-record" %}
{% set serviceName = "NHS App" %}
{% set contentTitle = "Test Result" %}
{% set yourHealthActive = "active" %}
{% block pageScripts %}

<script>

  var testType = "";
  var testResultsJson = [];

fetch('https://645b796ba8f9e4d6e7698d85.mockapi.io/nhs/EMIS', {
    method: 'GET',
    headers: {
        'Accept': 'application/json',
    },
})
   .then((response) => response.json())
   .then((data) => {
    
    console.log(JSON.stringify(data));
    console.log(data[0].MedicalRecord.TestResults.length);

    for (i = 0; i < data[0].MedicalRecord.TestResults.length; i++) {

   
        testType = data[0].MedicalRecord.TestResults[i];
        console.log("value: ", testType);

        let testChildValues = data[0].MedicalRecord.TestResults[i].ChildValues;
        if(testChildValues !== null ) {

          for (j = 0; j < data[0].MedicalRecord.TestResults[i].ChildValues.length; j++) {
          console.log("child values: ", data[0].MedicalRecord.TestResults[i].ChildValues);
          testResultsJson.push({
            testResultsData: data[0].MedicalRecord.TestResults[i].ChildValues[j], 
            testName: data[0].MedicalRecord.TestResults[i].ChildValues[j].Term,
            testValue: data[0].MedicalRecord.TestResults[i].ChildValues[j].NumericValue,
            testUnits: data[0].MedicalRecord.TestResults[i].ChildValues[j].NumericUnits,
            testRanges: data[0].MedicalRecord.TestResults[i].ChildValues[j].Range,
            testAbnormal: data[0].MedicalRecord.TestResults[i].ChildValues[j].Abnormal
          });
          }
        
        }

    }

    console.log("json result: ", testResultsJson);

    document.getElementById("patientTestName").innerHTML = testResultsJson[0].testName + ": <span id='patientTestValue' style='float:right;'>"+ testResultsJson[0].testValue + " " + testResultsJson[0].testUnits +"</span>";
    document.getElementById("testRange").innerHTML = testResultsJson[0].testRanges.Minimum + " - " + testResultsJson[0].testRanges.Maximum;
   // document.getElementById("indicatorResult").innerHTML = testResultsJson[0].testValue + " " + testResultsJson[0].testUnits;
   // document.getElementById("indicatorResult2").innerHTML = testResultsJson[0].testValue + " " + testResultsJson[0].testUnits;
   // document.getElementById("indicatorResult3").innerHTML = testResultsJson[0].testValue + " " + testResultsJson[0].testUnits;

    if( testResultsJson[0].testValue >= 135 && testResultsJson[0].testValue <= 180) {
       percentageResult = ((testResultsJson[0].testValue - 135) / 45 ) * 100;

       //document.getElementById("divIndicatorResult").style.marginLeft = percentageResult + '%';
       //document.getElementById("divIndicatorResult2").style.marginLeft = percentageResult + '%';
       //document.getElementById("divIndicatorResult3").style.marginLeft = percentageResult + '%';

       
       
    } else if ( testResultsJson[0].testValue > 180) {
      //document.getElementById("divIndicatorResult2").style.marginLeft = '115%';
    } else if ( testResultsJson[0].testValue < 135) {
      //document.getElementById("divIndicatorResult2").style.marginLeft = '-10px';
    }

    if(testResultsJson[0].testAbnormal == true) {
      document.getElementById("divAbnormal").style.display = "inline";
      document.getElementById("divNormal").style.display = "none";
    } else {
      document.getElementById("divAbnormal").style.display = "none";
      document.getElementById("divNormal").style.display = "inline";

    }

  })


</script>

{% endblock %}

<!-- Extends the layout from /app/views/layouts/layout.html -->
{% extends 'layouts/layout.html' %}


<!-- Set the page title -->
{% block pageTitle %}
  {{ contentTitle }} - {{ serviceName }}
{% endblock %}




<!-- Breadcrumb goes inside this block -->
{% block beforeContent %}
<nav class="nhsuk-breadcrumb nhsuk-breadcrumb-desktop" aria-label="Breadcrumb">
  <div class="nhsuk-width-container">
    <ol class="nhsuk-breadcrumb__list">
      <li class="nhsuk-breadcrumb__item"><a class="nhsuk-breadcrumb__link" href="/home">Home</a></li>
    </ol>
    <p class="nhsuk-breadcrumb__back"><a class="nhsuk-breadcrumb__backlink" href="/home">Back to home</a></p>
  </div>
</nav>

<nav class="nhsuk-breadcrumb nhsuk-breadcrumb-native" aria-label="Breadcrumb">
  <div class="nhsuk-width-container">
    <p class="nhsuk-breadcrumb__back"><a class="nhsuk-breadcrumb__backlink" href="javascript: window.history.go(-1)">Back</a></p>
  </div>
</nav>
{% endblock %}

{% block content %}
  <div class="nhsuk-grid-row">
    <div class="nhsuk-grid-column-two-thirds">

      <h1 class="nhsuk-heading-xl nhsuk-u-margin-bottom-5">Full blood count - FBC</h1>

      <div class="nhsuk-card nhsuk-card-dark-background nhsuk-u-margin-bottom-5">
        <div class="nhsuk-card__content">
          <div class="nhsuk-u-margin-top-0 nhsuk-u-margin-bottom-0">
            <h3 class="nhsuk-card__heading nhsuk-heading-xs nhsuk-u-margin-bottom-1">
            Test date
            </h3>
            <p>24 May 2023</p>

          </div>
          <hr class="nhsuk-u-margin-top-0 nhsuk-u-margin-bottom-3">

          <h3 class="nhsuk-card__heading nhsuk-heading-xs nhsuk-u-margin-bottom-1">
            Your healthcare professional's comment
          </h3>
          <p>Abnormal - but expected. Patient must keep appointment routine.</p>

          <hr class="nhsuk-u-margin-top-0 nhsuk-u-margin-bottom-3">

          <h3 class="nhsuk-card__heading nhsuk-heading-xs nhsuk-u-margin-bottom-1">
            Other comments
          </h3>
          <p> (NHSOnline) - Abnormal - Contact Patient Negative</p>

          <hr class="nhsuk-u-margin-top-0 nhsuk-u-margin-bottom-3">
          
        </div>

      </div>


      <details class="nhsuk-details nhsuk-expander">
        <summary class="nhsuk-details__summary">
          <span class="nhsuk-details__summary-text">
            Understanding your result
          </span>
        </summary>
        <div class="nhsuk-details__text">
          <p><b>Words you might see in your test result</b></p>
          <ul>
            <li><b>Normal:</b> your result is within the standard range. The standard range is not personal to you. It does not take
            into consideration your age, sex, and medical history.</li>
            <li><b>Abormal:</b> your result is outside the standard range. The standard range is not personal to you. It does not take
              into consideration your age, sex, and medical history.</li>
          </ul>
          <p>Your GP will usually contact you if you need to take further action.
            If you are concerned about any of your results, speak to your healthcare provider.</p>
        </div>
      </details>


      <h2>Your result</h2>

      <div class="nhsuk-card nhsuk-card-dark-background nhsuk-u-margin-bottom-2">
        <div class="nhsuk-card__content">
          <div class="nhsuk-u-margin-bottom-0">
          <h4 id="patientTestName" >
          </h4>         
          </div>

          <hr class="nhsuk-u-margin-top-2 nhsuk-u-margin-bottom-2">

          <p class="nhsuk-u-margin-bottom-0">Normal range: <span id="testRange" style="float:right;"></span></p>

          <hr class="nhsuk-u-margin-top-2 nhsuk-u-margin-bottom-4">

         <!-- <p class="nhsuk-u-margin-bottom-0">Current status: <span id="testRange" style="float:right;"></span></p>

          <hr class="nhsuk-u-margin-top-2 nhsuk-u-margin-bottom-5">-->

          <!--
          <details class="nhsuk-details nhsuk-u-margin-bottom-3">
            <summary class="nhsuk-details__summary">
              <span class="nhsuk-details__summary-text">
                View details
              </span>
            </summary>
            <div class="nhsuk-details__text">

              <div>
              <div class="nhsuk-u-margin-bottom-0" style="width:35%; margin-left:13%; height:80px; ">
                <div id="divIndicatorResult" style="width:100px; text-align: center;">
                <span class="nhsuk-body-s nhsuk-u-margin-bottom-1">Your result</span>
                <span id="indicatorResult" class="nhsuk-u-font-weight-bold">146 g/L</span><br>
                <span class="nhsuk-u-font-weight-bold"><img src="/images/downward-arrow.png" alt="indicator" width="30" height="30"></span>
              </div>
            </div>

              <div class="nhsuk-test-result-bar nhsuk-u-margin-bottom-9 nhsuk-u-margin-top-0">
                <div style="width:60%; height:30px; margin-left:20%; background-color: orange;">
                  <div class="nhsuk-result-normal-limits" style="width:60%; margin-left:15%;">
                    
                    <div style="height:30px;  background-color: green;"></div>
                    <div style="margin-top:20px;">
                      <span>135</span>
                      <span style="float:right;">180</span>
                    </div>
                  </div> 
                </div>
              </div></div>

          <div id="mainIndicator" style="display:block;">
              <div class="nhsuk-u-margin-bottom-0" style="width:61%; margin-left:3%; height:80px; ">
                <div id="divIndicatorResult2" style="width:100px; text-align: center;">
                <span class="nhsuk-body-s nhsuk-u-margin-bottom-1">Your result</span>
                <span id="indicatorResult2" class="nhsuk-u-font-weight-bold">146 g/L</span><br>
                <span class="nhsuk-u-font-weight-bold"><img src="/images/downward-arrow.png" alt="indicator" width="30" height="30"></span>
              </div>
            </div>

              <div class="nhsuk-test-result-bar-2 nhsuk-u-margin-bottom-9 nhsuk-u-margin-top-0">
                <div class="nhsuk-result-normal-limits" style="width:60%; margin-left:20%;"><div style="height:30px;  background-color: green;"></div>
                  <div style="margin-top:20px;">
                    <span>135</span>
                    <span style="float:right;">180</span>
                  </div>
                </div> 
            </div>

          </div>


          <div>
            <div class="nhsuk-u-margin-bottom-0" style="width:99%; margin-left:-35px; height:80px; ">
              <div id="divIndicatorResult3" style="width:80px; text-align: center;">
              <span class="nhsuk-body-s nhsuk-u-margin-bottom-1">Your result</span>
              <span id="indicatorResult3" class="nhsuk-u-font-weight-bold">146 g/L</span><br>
              <span class="nhsuk-u-font-weight-bold"><img src="/images/downward-arrow.png" alt="indicator" width="30" height="30"></span>
            </div>
          </div>

              <div class="nhsuk-result-normal-limits nhsuk-u-margin-bottom-9" style="width:100%;"><div style="height:30px;  background-color: green;"></div>
                <div style="margin-top:20px;">
                  <span>135</span>
                  <span style="float:right;">180</span>
                </div>
              </div>
          </div>

          <strong id="divAbnormal" style="display:none;" class="nhsuk-tag nhsuk-tag--yellow">
            Abnormal
          </strong>

          <strong id="divNormal" style="display:none;" class="nhsuk-tag nhsuk-tag--green">
            Normal
          </strong>

              <p><a href="/your-health/gp-record/result-tracking">Result history</a></p>
          
            </div>
          </details>-->


          <strong id="divAbnormal" style="display:none;" class="nhsuk-tag nhsuk-tag--yellow">
            Abnormal
          </strong>

          <strong id="divNormal" style="display:none;" class="nhsuk-tag nhsuk-tag--green">
            Normal
          </strong>


        </div>
      </div>



      <div class="nhsuk-card nhsuk-card-dark-background nhsuk-u-margin-bottom-2">
        <div class="nhsuk-card__content">
          <h4 class="nhsuk-card__heading nhsuk-u-margin-bottom-0">
            Total white cell count: <span style="float:right;">11.84 10*9/L</span>
          </h4>
          <hr class="nhsuk-u-margin-top-2 nhsuk-u-margin-bottom-2">

          <p class="nhsuk-u-margin-bottom-0">Normal range: <span style="float:right;">4.00 - 11.00</span></p>

          <hr class="nhsuk-u-margin-top-2 nhsuk-u-margin-bottom-5">

          <strong class="nhsuk-tag nhsuk-tag--yellow">
            Abnormal
          </strong>
          <!--<div class="nhsuk-body-s">* May be normal for you. Please contact your GP.</div>-->

        </div>
      </div>


      <div class="nhsuk-card nhsuk-card-dark-background nhsuk-u-margin-bottom-2">
        <div class="nhsuk-card__content">
          <h4 class="nhsuk-card__heading nhsuk-u-margin-bottom-0">
            Platelet count: <span style="float:right;">290 10*9/L</span>
          </h4>
          <hr class="nhsuk-u-margin-top-2 nhsuk-u-margin-bottom-2">

          <p class="nhsuk-u-margin-bottom-0">Normal range: <span style="float:right;">150 - 400</span></p>

          <hr class="nhsuk-u-margin-top-2 nhsuk-u-margin-bottom-5">

         <!-- <div class="nhsuk-u-margin-bottom-0" style="width:100px; margin-left:75%; text-align:center; background-color: white;">
            <span class="nhsuk-body-s nhsuk-u-margin-bottom-1">Your result</span>
            <span class="nhsuk-u-font-weight-bold">290 g/L</span><br>
            <span class="nhsuk-u-font-weight-bold"><img src="/images/downward-arrow.png" alt="indicator" width="30" height="30"></span>
          </div>

          <div class="nhsuk-test-result-bar-2 nhsuk-u-margin-bottom-9 nhsuk-u-margin-top-0">
            <div class="nhsuk-result-normal-limits" style="width:60%; margin-left:20%;"><div style="height:30px;  background-color: green;"></div>
              <div style="margin-top:20px;">
                <span>135</span>
                <span style="float:right;">180</span>
              </div>
            </div> 
        </div>-->

        <strong class="nhsuk-tag nhsuk-tag--green">
          Normal
        </strong>

        </div>
      </div>


      <div class="nhsuk-card nhsuk-card-dark-background nhsuk-u-margin-bottom-2">
        <div class="nhsuk-card__content">
          <h4 class="nhsuk-card__heading nhsuk-u-margin-bottom-0">
            Mean corpuscular volume (MCV): <span style="float:right;">100fL</span>
          </h4>
          <hr class="nhsuk-u-margin-top-2 nhsuk-u-margin-bottom-2">

          <p class="nhsuk-u-margin-bottom-0">Normal range: <span style="float:right;">78 - 100</span></p>

          <hr class="nhsuk-u-margin-top-2 nhsuk-u-margin-bottom-5">

          <strong class="nhsuk-tag nhsuk-tag--green">
            Normal
          </strong>

        </div>
      </div>


      <div class="nhsuk-card nhsuk-card-dark-background nhsuk-u-margin-bottom-2">
        <div class="nhsuk-card__content">
          <h4 class="nhsuk-card__heading nhsuk-u-margin-bottom-0">
            Haematocrit: <span style="float:right;">0.46</span>
          </h4>
          <hr class="nhsuk-u-margin-top-2 nhsuk-u-margin-bottom-2">

          <p class="nhsuk-u-margin-bottom-0">Normal range: <span style="float:right;">0.40 - 0.52</span></p>

          <hr class="nhsuk-u-margin-top-2 nhsuk-u-margin-bottom-5">

          <strong class="nhsuk-tag nhsuk-tag--green">
            Normal
          </strong>

        </div>
      </div>


      <div class="nhsuk-card nhsuk-card-dark-background nhsuk-u-margin-bottom-2">
        <div class="nhsuk-card__content">
          <h4 class="nhsuk-card__heading nhsuk-u-margin-bottom-0">
            Red blood cell (RBC): <span style="float:right;">4.56 10*12/L</span>
          </h4>
          <hr class="nhsuk-u-margin-top-2 nhsuk-u-margin-bottom-2">

          <p class="nhsuk-u-margin-bottom-0">Normal range: <span style="float:right;">4.50 - 6.50</span></p>

          <hr class="nhsuk-u-margin-top-2 nhsuk-u-margin-bottom-5">

          <strong class="nhsuk-tag nhsuk-tag--green">
            Normal
          </strong>

        </div>
      </div>


      <div class="nhsuk-card nhsuk-card-dark-background nhsuk-u-margin-bottom-2">
        <div class="nhsuk-card__content">
          <h5 class="nhsuk-card__heading nhsuk-u-margin-bottom-0">
            Mean corpusc. haemoglobin (MCH): <span style="float:right;">32.0 pg</span>
          </h5>
          <hr class="nhsuk-u-margin-top-2 nhsuk-u-margin-bottom-2">

          <p class="nhsuk-u-margin-bottom-0">Normal range: <span style="float:right;">27.0 - 32.0</span></p>

          <hr class="nhsuk-u-margin-top-2 nhsuk-u-margin-bottom-5">

          <strong class="nhsuk-tag nhsuk-tag--green">
            Normal
          </strong>

        </div>
      </div>

      <div class="nhsuk-card nhsuk-card-dark-background nhsuk-u-margin-bottom-2">
        <div class="nhsuk-card__content">
          <h4 class="nhsuk-card__heading nhsuk-u-margin-bottom-0">
            Red blood cell distribute width: <span style="float:right;">14.1</span>
          </h4>
          <hr class="nhsuk-u-margin-top-2 nhsuk-u-margin-bottom-2">

          <p class="nhsuk-u-margin-bottom-0">Normal range: <span style="float:right;">11.5 - 15.0</span></p>

          <hr class="nhsuk-u-margin-top-2 nhsuk-u-margin-bottom-5">

          <strong class="nhsuk-tag nhsuk-tag--green">
            Normal
          </strong>
        </div>
      </div>

      <div class="nhsuk-card nhsuk-card-dark-background nhsuk-u-margin-bottom-2">
        <div class="nhsuk-card__content">
          <h4 class="nhsuk-card__heading nhsuk-u-margin-bottom-0">
            Neutrophil count: <span style="float:right;">6.14 10*9/L</span>
          </h4>
          <hr class="nhsuk-u-margin-top-2 nhsuk-u-margin-bottom-2">

          <p class="nhsuk-u-margin-bottom-0">Normal range: <span style="float:right;">2.00 - 7.50</span></p>

          <hr class="nhsuk-u-margin-top-2 nhsuk-u-margin-bottom-5">

          <strong class="nhsuk-tag nhsuk-tag--green">
            Normal
          </strong>
        </div>
      </div>

      <div class="nhsuk-card nhsuk-card-dark-background nhsuk-u-margin-bottom-2">
        <div class="nhsuk-card__content">
          <h4 class="nhsuk-card__heading nhsuk-u-margin-bottom-0">
            Lymphocyte count: <span style="float:right;">1.54 10*9/L</span>
          </h4>
          <hr class="nhsuk-u-margin-top-2 nhsuk-u-margin-bottom-2">

          <p class="nhsuk-u-margin-bottom-0">Normal range: <span style="float:right;">2.00 - 7.50</span></p>

          <hr class="nhsuk-u-margin-top-2 nhsuk-u-margin-bottom-5">

          <strong class="nhsuk-tag nhsuk-tag--green">
            Normal
          </strong>
        </div>
      </div>

      <div class="nhsuk-card nhsuk-card-dark-background nhsuk-u-margin-bottom-2">
        <div class="nhsuk-card__content">
          <h4 class="nhsuk-card__heading nhsuk-u-margin-bottom-0">
            Monocyte count: <span style="float:right;">0.35 10*9/L</span>
          </h4>
          <hr class="nhsuk-u-margin-top-2 nhsuk-u-margin-bottom-2">

          <p class="nhsuk-u-margin-bottom-0">Normal range: <span style="float:right;">0.20 - 0.80</span></p>

          <hr class="nhsuk-u-margin-top-2 nhsuk-u-margin-bottom-5">

          <strong class="nhsuk-tag nhsuk-tag--green">
            Normal
          </strong>
        </div>
      </div>


      <div class="nhsuk-card nhsuk-card-dark-background nhsuk-u-margin-bottom-2">
        <div class="nhsuk-card__content">
          <h4 class="nhsuk-card__heading nhsuk-u-margin-bottom-0">
            Eosinophil count: <span style="float:right;">0.45 10*9/L</span>
          </h4>
          <hr class="nhsuk-u-margin-top-2 nhsuk-u-margin-bottom-2">

          <p class="nhsuk-u-margin-bottom-0">Normal range: <span style="float:right;">0.04 - 0.40</span></p>

          <hr class="nhsuk-u-margin-top-2 nhsuk-u-margin-bottom-5">

          <strong class="nhsuk-tag nhsuk-tag--green">
            Normal
          </strong>
        </div>
      </div>

      <div class="nhsuk-card nhsuk-card-dark-background nhsuk-u-margin-bottom-2">
        <div class="nhsuk-card__content">
          <h4 class="nhsuk-card__heading nhsuk-u-margin-bottom-0">
            Basophil count: <span style="float:right;">0.03 10*9/L</span>
          </h4>
          <hr class="nhsuk-u-margin-top-2 nhsuk-u-margin-bottom-2">

          <p class="nhsuk-u-margin-bottom-0">Normal range: <span style="float:right;"> - 0.10</span></p>

          <hr class="nhsuk-u-margin-top-2 nhsuk-u-margin-bottom-5">

          <strong class="nhsuk-tag nhsuk-tag--green">
            Normal
          </strong>
        </div>
      </div>


      <div class="nhsuk-card nhsuk-card-dark-background nhsuk-u-margin-bottom-2">
        <div class="nhsuk-card__content">
          <h4 class="nhsuk-card__heading nhsuk-u-margin-bottom-0">
            Large unstained cells: <span style="float:right;">0.13 10*9/L</span>
          </h4>
          <hr class="nhsuk-u-margin-top-2 nhsuk-u-margin-bottom-2">

          <p class="nhsuk-u-margin-bottom-0">Normal range: <span style="float:right;"> - 0.60</span></p>

          <hr class="nhsuk-u-margin-top-2 nhsuk-u-margin-bottom-5">

          <strong class="nhsuk-tag nhsuk-tag--green">
            Normal
          </strong>
        </div>
      </div>


      <div class="nhsuk-card nhsuk-card-dark-background nhsuk-u-margin-bottom-2">
        <div class="nhsuk-card__content">
          <h4 class="nhsuk-card__heading nhsuk-u-margin-bottom-0">
            Percentage hypochromic cells: <span style="float:right;">1%</span>
          </h4>
          <hr class="nhsuk-u-margin-top-2 nhsuk-u-margin-bottom-2">

          <p class="nhsuk-u-margin-bottom-0">Normal range: <span style="float:right;"> - </span></p>

          <hr class="nhsuk-u-margin-top-2 nhsuk-u-margin-bottom-5">

          <strong class="nhsuk-tag nhsuk-tag--green">
            Normal
          </strong>
        </div>
      </div>

    </div>
  </div>

  <section class="nhsuk-section">
    <div class="nhsuk-width-container">
    <div class="nhsuk-grid-row nhsuk-u-margin-bottom-8">
        <ul class="panel-link nhsuk-u-margin-top-5">
          <li class="panel-link__item">
            <a class="panel-link__link" href="/your-health/data-opt-out/overview">
            <h2 class="panel-link__heading nhsuk-heading-s">Learn more about test results</h2>
            </a>
           </li>
        </ul>
      
        <p>You may see medical abbreviations you are not familiar with.</p>

        <div class="nhsuk-action-link">
          <a class="nhsuk-action-link__link" href="https://www.nhs.uk/using-the-nhs/nhs-services/the-nhs-app/abbreviations/">
            <svg class="nhsuk-icon nhsuk-icon__arrow-right-circle" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" aria-hidden="true">
              <path d="M0 0h24v24H0z" fill="none"></path>
              <path d="M12 2a10 10 0 0 0-9.95 9h11.64L9.74 7.05a1 1 0 0 1 1.41-1.41l5.66 5.65a1 1 0 0 1 0 1.42l-5.66 5.65a1 1 0 0 1-1.41 0 1 1 0 0 1 0-1.41L13.69 13H2.05A10 10 0 1 0 12 2z"></path>
            </svg>
            <span class="nhsuk-action-link__text">Help with abbreviations</span>
          </a>
        </div>

        
      </div>

       
      </div>
      </section>
{% endblock %}
